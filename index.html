<!DOCTYPE html> 
 <html lang="pl"> 
 <head> 
 	 <meta charset="UTF-8"> 
 	 <meta name="viewport" content="width=device-width, initial-scale=1.0">
	 <meta name="color-scheme" content="light">
	 <meta name="theme-color" content="#dc2626">
 	 <title>PDF Signer</title> 
 	 <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script> 
 	 <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script> 
 	 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> 
 	 <style> 
 		 :root { 
 			 --primary-red: #dc2626; 
 			 --primary-red-dark: #b91c1c; 
 		 } 

 		 body { 
 			 font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
 			 background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); 
 			 min-height: 100vh; 
 			 margin: 0; 
 			 padding: 20px 0; 
 		 } 

 		 .header-gradient { 
 			 background: linear-gradient(135deg, var(--primary-red) 0%, var(--primary-red-dark) 100%); 
 			 color: white; 
 			 padding: 20px; 
 			 border-radius: 15px 15px 0 0; 
 			 text-align: center; 
 			 box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3); 
 		 } 

 		 /* Zaktualizowana regu≈Ça dla szerszego layoutu na desktopie */
 		 .main-container { 
 			 width: 95%;
 			 max-width: 1200px;
 			 margin: 0 auto; 
 			 background: white; 
 			 border-radius: 15px; 
 			 box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); 
 			 overflow: hidden; 
 		 } 

 		 .step-indicator { 
 			 display: flex; 
 			 justify-content: center; 
 			 margin: 20px 0; 
 			 gap: 10px; 
 		 } 

 		 .step { 
 			 width: 40px; 
 			 height: 40px; 
 			 border-radius: 50%; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 font-weight: bold; 
 			 color: white; 
 			 background: #6b7280; 
 			 transition: all 0.3s ease; 
 		 } 

 		 .step.active { 
 			 background: var(--primary-red); 
 			 transform: scale(1.1); 
 		 } 

 		 .step.completed { 
 			 background: #10b981; 
 		 } 

 		 .card { 
 			 border: none; 
 			 border-radius: 15px; 
 			 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); 
 			 margin: 20px; 
 			 padding: 25px; 
 		 } 

 		 .btn-primary { 
 			 background: var(--primary-red); 
 			 border: none; 
 			 border-radius: 10px; 
 			 min-height: 44px; 
 			 font-weight: 600; 
 			 transition: all 0.3s ease; 
 		 } 

 		 .btn-primary:hover { 
 			 background: var(--primary-red-dark); 
 			 transform: translateY(-2px); 
 			 box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3); 
 		 } 

 		 .btn-secondary { 
 			 border-radius: 10px; 
 			 min-height: 44px; 
 			 font-weight: 600; 
 		 } 

 		 .upload-zone { 
 			 border: 3px dashed #d1d5db; 
 			 border-radius: 15px; 
 			 padding: 40px 20px; 
 			 text-align: center; 
 			 cursor: pointer; 
 			 transition: all 0.3s ease; 
 			 background: #f9fafb; 
 		 } 

 		 .upload-zone:hover, .upload-zone.dragover { 
 			 border-color: var(--primary-red); 
 			 background: #fef2f2; 
 		 } 

 		 .signature-canvas { 
 			 border: 2px solid #e5e7eb; 
 			 border-radius: 10px; 
 			 width: 100%; 
 			 height: 200px; 
 			 touch-action: none; 
 			 background: white; 
 		 } 

 		 .color-picker { 
 			 display: flex; 
 			 gap: 15px; 
 			 justify-content: center; 
 			 margin: 15px 0; 
 		 } 

 		 .color-btn { 
 			 width: 40px; 
 			 height: 40px; 
 			 border-radius: 50%; 
 			 border: 3px solid transparent; 
 			 cursor: pointer; 
 			 transition: all 0.3s ease; 
 		 } 

 		 .color-btn.active { 
 			 border-color: #374151; 
 			 transform: scale(1.1); 
 		 } 

 		 .pdf-container { 
 			 border: 2px solid #e5e7eb; 
 			 border-radius: 10px; 
 			 position: relative; 
 			 overflow: hidden; 
 			 background: white; 
 		 } 

 		 .pdf-page { 
 			 width: 100%; 
 			 cursor: crosshair; 
 		 } 

 		 .signature-preview { 
 			 position: absolute; 
 			 border: 2px dashed #3b82f6; 
 			 background: rgba(59, 130, 246, 0.1); 
 			 border-radius: 6px; 
 			 cursor: move; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 z-index: 15; 
 			 user-select: none; 
 			 pointer-events: auto; 
 		 } 

 		 .signature-overlay-mobile { 
 			 position: absolute; 
 			 border: 2px dashed #3b82f6; 
 			 background: rgba(59, 130, 246, 0.1); 
 			 border-radius: 6px; 
 			 cursor: move; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 z-index: 15; 
 			 user-select: none; 
 		 } 

 		 .resize-handle { 
 			 position: absolute; 
 			 bottom: -10px; 
 			 right: -10px; 
 			 width: 24px; 
 			 height: 24px; 
 			 background: #3b82f6; 
 			 border-radius: 50%; 
 			 cursor: se-resize; 
 			 border: 3px solid white; 
 			 box-shadow: 0 2px 8px rgba(0,0,0,0.3); 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 font-size: 10px; 
 			 color: white; 
 			 font-weight: bold; 
 		 } 

 		 .signature-controls { 
 			 position: absolute; 
 			 top: -40px; 
 			 left: 0; 
 			 right: 0; 
 			 display: flex; 
 			 gap: 5px; 
 			 justify-content: center; 
 			 z-index: 20; 
 		 } 

 		 .signature-btn { 
 			 background: #10b981; 
 			 color: white; 
 			 border: none; 
 			 border-radius: 15px; 
 			 padding: 4px 8px; 
 			 font-size: 11px; 
 			 font-weight: bold; 
 			 cursor: pointer; 
 			 box-shadow: 0 2px 8px rgba(0,0,0,0.3); 
 			 transition: all 0.2s; 
 		 } 

 		 .signature-btn:hover { 
 			 background: #059669; 
 			 transform: scale(1.05); 
 		 } 

 		 .signature-btn.applied { 
 			 background: #6b7280; 
 			 cursor: default; 
 		 } 

 		 .size-controls { 
 			 display: flex; 
 			 gap: 10px; 
 			 justify-content: center; 
 			 margin: 15px 0; 
 		 } 

 		 .size-btn { 
 			 width: 40px; 
 			 height: 40px; 
 			 border-radius: 50%; 
 			 border: 2px solid #e2e8f0; 
 			 background: white; 
 			 cursor: pointer; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 transition: all 0.2s; 
 			 font-weight: bold; 
 		 } 

 		 .size-btn:hover { 
 			 border-color: #dc2626; 
 			 background: #fef2f2; 
 		 } 

 		 .page-navigation { 
 			 display: flex; 
 			 justify-content: space-between; 
 			 align-items: center; 
 			 padding: 15px; 
 			 background: #f9fafb; 
 			 border-top: 1px solid #e5e7eb; 
 		 } 

 		 .modal { 
 			 backdrop-filter: blur(5px); 
 		 } 

 		 .modal-content { 
 			 border-radius: 15px; 
 			 border: none; 
 			 box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3); 
 		 } 

 		 .progress-bar { 
 			 background: var(--primary-red); 
 			 border-radius: 10px; 
 		 } 

 		 .alert { 
 			 border-radius: 10px; 
 			 border: none; 
 		 } 

 		 .download-link { 
 			 color: var(--primary-red); 
 			 text-decoration: none; 
 			 font-weight: 600; 
 		 } 

 		 .download-link:hover { 
 			 color: var(--primary-red-dark); 
 			 text-decoration: underline; 
 		 } 

 		 .step-content { 
 			 display: none; 
 		 } 

 		 .step-content.active { 
 			 display: block; 
 		 } 

 		 .multi-page-controls { 
 			 background: #f0f9ff; 
 			 border: 2px solid #3b82f6; 
 			 border-radius: 10px; 
 			 padding: 15px; 
 			 margin: 15px 0; 
 			 text-align: center; 
 		 } 

 		 .btn-success { 
 			 background: #10b981; 
 			 border: none; 
 			 border-radius: 10px; 
 			 min-height: 44px; 
 			 font-weight: 600; 
 			 transition: all 0.3s ease; 
 		 } 

 		 .btn-success:hover { 
 			 background: #059669; 
 			 transform: translateY(-2px); 
 			 box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); 
 		 } 

 		 .page-status { 
 			 display: flex; 
 			 flex-wrap: wrap; 
 			 gap: 5px; 
 			 justify-content: center; 
 			 margin: 10px 0; 
 		 } 

 		 .page-indicator { 
 			 width: 30px; 
 			 height: 30px; 
 			 border-radius: 50%; 
 			 display: flex; 
 			 align-items: center; 
 			 justify-content: center; 
 			 font-size: 12px; 
 			 font-weight: bold; 
 			 border: 2px solid #e5e7eb; 
 			 background: white; 
 			 transition: all 0.3s ease; 
 		 } 

 		 .page-indicator.current { 
 			 border-color: #3b82f6; 
 			 background: #3b82f6; 
 			 color: white; 
 		 } 

 		 .page-indicator.signed { 
 			 border-color: #10b981; 
 			 background: #10b981; 
 			 color: white; 
 		 } 

 		 @media (max-width: 576px) { 
 			 .main-container {
 				 width: 100%;
 				 margin: 0;
 				 border-radius: 0;
 			 } 
 			 
 			 .card { 
 				 margin: 10px; 
 				 padding: 20px; 
 			 } 
 			 
 			 .upload-zone { 
 				 padding: 30px 15px; 
 			 } 
 		 } 
 	 </style> 
 </head> 
 <body> 
 	 <div class="main-container"> 
 		 <div class="header-gradient"> 
 			 <h1>üìù PDF Signer</h1> 
 			 <p class="mb-0">Podpisuj dokumenty PDF na dowolnym urzƒÖdzeniu</p> 
 		 </div> 

 		 <div class="step-indicator"> 
 			 <div class="step active" id="step-1">1</div> 
 			 <div class="step" id="step-2">2</div> 
 			 <div class="step" id="step-3">3</div> 
 			 <div class="step" id="step-4">4</div> 
 		 </div> 

 		 <div class="step-content active" id="content-1"> 
 			 <div class="card"> 
 				 <h3>üìÅ Krok 1: Wybierz plik PDF</h3> 
 				 <div class="upload-zone" id="uploadZone"> 
 					 <div class="mb-3"> 
 						 <i class="bi bi-cloud-upload" style="font-size: 3rem; color: var(--primary-red);"></i> 
 					 </div> 
 					 <h5>PrzeciƒÖgnij plik PDF tutaj</h5> 
 					 <p class="text-muted">lub kliknij aby wybraƒá plik</p> 
 					 <small class="text-muted">Maksymalny rozmiar: 10MB</small> 
 				 </div> 
 				 <input type="file" id="fileInput" accept=".pdf" style="display: none;"> 
 				 <div id="fileInfo" class="mt-3" style="display: none;"> 
 					 <div class="alert alert-success"> 
 						 <strong>üìÑ Plik za≈Çadowany:</strong> <span id="fileName"></span> 
 					 </div> 
 					 <button class="btn btn-primary w-100" onclick="nextStep()"> 
 						 Przejd≈∫ do podpisu ‚û°Ô∏è 
 					 </button> 
 				 </div> 
 			 </div> 
 		 </div> 

 		 <div class="step-content" id="content-2"> 
 			 <div class="card"> 
 				 <h3>‚úçÔ∏è Krok 2: Utw√≥rz podpis</h3> 
 				 <p class="text-muted">Dotknij i rysuj palcem lub myszƒÖ</p> 
 				 
 				 <div class="color-picker"> 
 					 <div class="color-btn active" data-color="#000000" style="background: #000000;"></div> 
 					 <div class="color-btn" data-color="#dc2626" style="background: #dc2626;"></div> 
 					 <div class="color-btn" data-color="#2563eb" style="background: #2563eb;"></div> 
 					 <div class="color-btn" data-color="#16a34a" style="background: #16a34a;"></div> 
 				 </div> 

 				 <canvas id="signatureCanvas" class="signature-canvas"></canvas> 
 				 
 				 <div class="d-flex gap-2 mt-3"> 
 					 <button class="btn btn-secondary flex-fill" onclick="clearSignature()"> 
 						 üóëÔ∏è Wyczy≈õƒá 
 					 </button> 
 					 <button class="btn btn-primary flex-fill" onclick="nextStep()" id="signatureNext" disabled> 
 						 Dalej ‚û°Ô∏è 
 					 </button> 
 				 </div> 
 			 </div> 
 		 </div> 

 		 <div class="step-content" id="content-3"> 
 			 <div class="card"> 
 				 <h3 style="display: flex; align-items: center; gap: 8px;"> 
 					 <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> 
 						 <path d="M9 11H5a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2h-4"/> 
 						 <path d="M9 7l3-3 3 3"/> 
 						 <path d="M12 2v9"/> 
 					 </svg> 
 					 Umie≈õƒá podpis na dokumencie 
 				 </h3> 

 				 <div class="page-navigation"> 
 					 <button class="btn btn-secondary" onclick="previousPage()" id="prevPageBtn" disabled> 
 						 ‚Üê Poprzednia 
 					 </button> 
 					 <span id="pageInfo" style="font-weight: 600; min-width: 100px; text-align: center;">Strona 1 z 1</span> 
 					 <button class="btn btn-secondary" onclick="nextPage()" id="nextPageBtn" disabled> 
 						 Nastƒôpna ‚Üí 
 					 </button> 
 				 </div> 

 				 <div class="pdf-container" id="pdfContainer" style="border: 3px solid #3b82f6; background: #f0f9ff; position: relative; overflow: auto; min-height: 500px; border-radius: 12px;"> 
 					 <canvas id="pdfCanvas" class="pdf-page"></canvas> 
 					 <div class="signature-preview" id="signaturePreview"></div> 
 				 </div> 

 				 <div class="size-controls" style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin: 1rem 0;"> 
 					 <button class="size-btn" id="decrease-size" onclick="changeSignatureSize(-1)" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #e2e8f0; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">-</button> 
 					 <div class="size-display" id="size-display" style="font-size: 0.875rem; font-weight: 600; color: #1f2937; min-width: 80px; text-align: center;">Ma≈Çy</div> 
 					 <button class="size-btn" id="increase-size" onclick="changeSignatureSize(1)" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #e2e8f0; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">+</button> 
 				 </div> 

 				 <div class="multi-page-controls" id="multiPageControls" style="display: none;"> 
 					 <h5>üìÑ Status stron</h5> 
 					 <div class="page-status" id="pageStatus"> 
 						 </div> 
 					 
 					 <div class="d-flex gap-2 mt-3 justify-content-center"> 
 						 <button class="btn btn-primary" onclick="applyToAllPages()" id="applyAllBtn" style="display: none;"> 
 							 üìÑ Dodaj do wszystkich stron 
 						 </button> 
 					 </div> 
 				 </div> 

 				 <div class="d-flex gap-2 mt-3"> 
 					 <button class="btn btn-secondary" onclick="previousStep()"> 
 						 <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;"> 
 							 <path d="M19 12H5"/> 
 							 <path d="M12 19l-7-7 7-7"/> 
 						 </svg> 
 						 Wstecz 
 					 </button> 
 					 <button class="btn btn-primary flex-fill" onclick="nextStep()" id="placementNext" disabled style="touch-action: manipulation;"> 
 						 <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;"> 
 							 <path d="M9 12l2 2 4-4"/> 
 							 <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9 9-9-4.03-9-9 4.03-9 9-9"/> 
 						 </svg> 
 						 Potwierd≈∫ 
 					 </button> 
 				 </div> 
 			 </div> 
 		 </div> 

 		 <div class="step-content" id="content-4"> 
 			 <div class="card"> 
 				 <h3>‚úÖ Krok 4: Gotowe!</h3> 
 				 <div id="processingIndicator" class="text-center"> 
 					 <div class="spinner-border text-danger" role="status"> 
 						 <span class="visually-hidden">Przetwarzanie...</span> 
 					 </div> 
 					 <p class="mt-3">Generujƒô podpisany PDF...</p> 
 				 </div> 
 				 
 				 <div id="downloadSection" style="display: none;"> 
 					 <div class="alert alert-success"> 
 						 <strong>üéâ Sukces!</strong> Tw√≥j plik zosta≈Ç podpisany. 
 					 </div> 
 					 
 					 <div class="d-grid gap-2"> 
 						 <button class="btn btn-primary" onclick="downloadPdf()"> 
 							 üì• Pobierz podpisany PDF 
 						 </button> 
 						 <button class="btn btn-secondary" onclick="sendEmail()"> 
 							 üìß Wy≈õlij email 
 						 </button> 
 						 <button class="btn btn-outline-secondary" onclick="signAnother()"> 
 							 üîÑ Podpisz kolejny 
 						 </button> 
 					 </div> 
 					 
 					 <div class="mt-3 text-center"> 
 						 <small class="text-muted"> 
 							 Mo≈ºesz te≈º kliknƒÖƒá na:  
 							 <button onclick="downloadPdf()" id="downloadFileName" class="download-link" style="background: none; border: none; text-decoration: underline;">document_podpisany.pdf</button> 
 						 </small> 
 					 </div> 
 				 </div> 
 			 </div> 
 		 </div> 
 	 </div> 

 	 <div class="modal fade" id="passwordModal" tabindex="-1" aria-hidden="true"> 
 		 <div class="modal-dialog"> 
 			 <div class="modal-content"> 
 				 <div class="modal-header"> 
 					 <h5 class="modal-title">üîí Plik chroniony has≈Çem</h5> 
 				 </div> 
 				 <div class="modal-body"> 
 					 <p>Ten plik PDF jest chroniony has≈Çem. Wprowad≈∫ has≈Ço aby kontynuowaƒá:</p> 
 					 <input type="password" class="form-control" id="passwordInput" placeholder="Wprowad≈∫ has≈Ço..."> 
 					 <div id="passwordError" class="alert alert-danger mt-2" style="display: none;"></div> 
 				 </div> 
 				 <div class="modal-footer"> 
 					 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button> 
 					 <button type="button" class="btn btn-primary" onclick="unlockPdf()">Odblokuj</button> 
 				 </div> 
 			 </div> 
 		 </div> 
 	 </div> 

 	 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> 
 	 <script> 
 		 // Globalne zmienne 
 		 let currentStep = 1; 
 		 let pdfFile = null; 
 		 let pdfDoc = null; 
 		 let signatureDataUrl = null; 
 		 let signaturePosition = null; 
 		 let signatureSize = 15; 
 		 let signatureSizes = [8, 12, 15, 20, 25, 30, 35]; 
 		 let signatureSizeNames = ['Bardzo ma≈Çy', 'Ma≈Çy', '≈öredni', 'Du≈ºy', 'Bardzo du≈ºy', 'Ogromny', 'Maksymalny']; 
 		 let currentSizeIndex = 2; 
 		 let currentPage = 1; 
 		 let totalPages = 1; 
 		 let isPasswordProtected = false; 
 		 let originalPassword = null; 
 		 let unlockedPdfBytes = null; 

 		 // Zmienne dla funkcjonalno≈õci wielostronicowej 
 		 let signaturePositions = {};
 		 let acceptedPosition = null; 
 		 let signedPages = new Set(); 

 		 // Canvas dla podpisu 
 		 let canvas = null; 
 		 let ctx = null; 
 		 let isDrawing = false; 
 		 let currentColor = '#000000'; 
 		 let hasSignature = false; 

 		 // PDF.js setup 
 		 pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'; 

 		 // Inicjalizacja 
 		 document.addEventListener('DOMContentLoaded', function() { 
 			 setupFileUpload(); 
 			 setupSignatureCanvas(); 
 			 setupColorPicker(); 
 			 setupSizeControls(); 
 		 }); 

 		 function setupFileUpload() { 
 			 const uploadZone = document.getElementById('uploadZone'); 
 			 const fileInput = document.getElementById('fileInput'); 

 			 uploadZone.addEventListener('click', () => fileInput.click()); 
 			 
 			 uploadZone.addEventListener('dragover', (e) => { 
 				 e.preventDefault(); 
 				 uploadZone.classList.add('dragover'); 
 			 }); 

 			 uploadZone.addEventListener('dragleave', () => { 
 				 uploadZone.classList.remove('dragover'); 
 			 }); 

 			 uploadZone.addEventListener('drop', (e) => { 
 				 e.preventDefault(); 
 				 uploadZone.classList.remove('dragover'); 
 				 const files = e.dataTransfer.files; 
 				 if (files.length > 0) { 
 					 handleFileSelect(files[0]); 
 				 } 
 			 }); 

 			 fileInput.addEventListener('change', (e) => { 
 				 if (e.target.files.length > 0) { 
 					 handleFileSelect(e.target.files[0]); 
 				 } 
 			 }); 
 		 } 

 		 async function handleFileSelect(file) { 
 			 if (file.type !== 'application/pdf') { 
 				 alert('‚ùå Mo≈ºna wybraƒá tylko pliki PDF!'); 
 				 return; 
 			 } 

 			 if (file.size > 10 * 1024 * 1024) { 
 				 alert('‚ùå Plik jest za du≈ºy! Maksymalny rozmiar to 10MB.'); 
 				 return; 
 			 } 

 			 pdfFile = file; 
 			 
 			 document.getElementById('fileName').textContent = file.name; 
 			 document.getElementById('fileInfo').style.display = 'block'; 

 			 try { 
 				 const arrayBuffer = await file.arrayBuffer(); 
 				 
 				 try { 
 					 const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer }); 
 					 const testDoc = await loadingTask.promise; 
 					 
 					 isPasswordProtected = false; 
 					 pdfDoc = testDoc; 
 					 totalPages = pdfDoc.numPages; 
 					 currentPage = 1; 
 					 
 				 } catch (pdfError) { 
 					 if (pdfError.name === 'PasswordException') { 
 						 isPasswordProtected = true; 
 						 showPasswordModal(); 
 					 } else { 
 						 console.error('B≈ÇƒÖd ≈Çadowania PDF:', pdfError); 
 						 alert('‚ùå B≈ÇƒÖd podczas ≈Çadowania pliku PDF: ' + pdfError.message); 
 					 } 
 				 } 
 				 
 			 } catch (error) { 
 				 console.error('Nieoczekiwany b≈ÇƒÖd:', error); 
 				 alert('‚ùå WystƒÖpi≈Ç nieoczekiwany b≈ÇƒÖd: ' + error.message); 
 			 } 
 		 } 

 		 async function loadPdfDocument(arrayBuffer, password = null) { 
 			 try { 
 				 const loadingTask = pdfjsLib.getDocument({ 
 					 data: arrayBuffer, 
 					 password: password 
 				 }); 
 				 
 				 pdfDoc = await loadingTask.promise; 
 				 totalPages = pdfDoc.numPages; 
 				 currentPage = 1;

 			 } catch (error) { 
 				 if (error.name === 'PasswordException') { 
 					 throw new Error('B≈Çƒôdne has≈Ço'); 
 				 } 
 				 throw error; 
 			 } 
 		 } 

 		 function showPasswordModal() { 
 			 const modal = new bootstrap.Modal(document.getElementById('passwordModal')); 
 			 modal.show(); 
 		 } 

 		 async function unlockPdf() { 
 			 const password = document.getElementById('passwordInput').value; 
 			 const errorDiv = document.getElementById('passwordError'); 
 			 
 			 if (!password) { 
 				 errorDiv.textContent = 'Wprowad≈∫ has≈Ço'; 
 				 errorDiv.style.display = 'block'; 
 				 return; 
 			 } 

 			 try { 
 				 const arrayBuffer = await pdfFile.arrayBuffer(); 
 				 await loadPdfDocument(arrayBuffer, password); 
 				 
 				 originalPassword = password; 
 				 isPasswordProtected = true; 
 				 
 				 const modal = bootstrap.Modal.getInstance(document.getElementById('passwordModal')); 
 				 modal.hide(); 
 				 
 				 document.getElementById('passwordInput').value = ''; 
 				 errorDiv.style.display = 'none'; 
 				 
 			 } catch (error) { 
 				 errorDiv.textContent = error.message; 
 				 errorDiv.style.display = 'block'; 
 				 console.error('B≈ÇƒÖd odblokowania PDF:', error); 
 			 } 
 		 } 

 		 function setupSignatureCanvas() { 
 			 canvas = document.getElementById('signatureCanvas'); 
 			 if (!canvas) return; 
 			 
 			 ctx = canvas.getContext('2d'); 
 			 
 			 const ratio = Math.max(window.devicePixelRatio || 1, 1);
 			 canvas.width = canvas.offsetWidth * ratio;
 			 canvas.height = canvas.offsetHeight * ratio;
 			 canvas.getContext("2d").scale(ratio, ratio);
 			 
 			 ctx.lineCap = 'round'; 
 			 ctx.lineJoin = 'round'; 
 			 ctx.lineWidth = 2; 
 			 ctx.strokeStyle = currentColor; 
 			 
 			 canvas.addEventListener('mousedown', startDrawing); 
 			 canvas.addEventListener('mousemove', draw); 
 			 canvas.addEventListener('mouseup', stopDrawing); 
 			 canvas.addEventListener('mouseout', stopDrawing); 
 			 
 			 canvas.addEventListener('touchstart', handleTouch, { passive: false }); 
 			 canvas.addEventListener('touchmove', handleTouch, { passive: false }); 
 			 canvas.addEventListener('touchend', handleTouch, { passive: false }); 
 		 } 

 		 function getEventPos(e) {
 			 const rect = canvas.getBoundingClientRect();
 			 if (e.touches && e.touches.length > 0) {
 				 return {
 					 x: e.touches[0].clientX - rect.left,
 					 y: e.touches[0].clientY - rect.top
 				 };
 			 }
 			 return {
 				 x: e.clientX - rect.left,
 				 y: e.clientY - rect.top
 			 };
 		 }

 		 function startDrawing(e) { 
 			 isDrawing = true; 
 			 const { x, y } = getEventPos(e);
 			 ctx.beginPath(); 
 			 ctx.moveTo(x, y); 
 		 } 

 		 function draw(e) { 
 			 if (!isDrawing) return; 
 			 const { x, y } = getEventPos(e);
 			 ctx.lineTo(x, y); 
 			 ctx.stroke(); 
 			 
 			 if (!hasSignature) { 
 				 hasSignature = true; 
 				 document.getElementById('signatureNext').disabled = false; 
 			 } 
 		 } 

 		 function stopDrawing() { 
 			 if (isDrawing) { 
 				 isDrawing = false; 
 				 ctx.beginPath(); 
 			 } 
 		 } 

 		 function handleTouch(e) { 
 			 e.preventDefault(); 
 			 const touch = e.touches[0] || e.changedTouches[0]; 
 			 if (!touch) return; 
 			 
 			 const eventMap = {
 				 touchstart: 'mousedown',
 				 touchmove: 'mousemove',
 				 touchend: 'mouseup'
 			 };

 			 const mouseEvent = new MouseEvent(eventMap[e.type], { 
 				 clientX: touch.clientX, 
 				 clientY: touch.clientY 
 			 }); 
 			 canvas.dispatchEvent(mouseEvent); 
 		 } 

 		 function clearSignature() { 
 			 if (ctx) { 
 				 ctx.clearRect(0, 0, canvas.width, canvas.height); 
 				 hasSignature = false; 
 				 document.getElementById('signatureNext').disabled = true; 
 			 } 
 		 } 

 		 function setupColorPicker() { 
 			 const colorBtns = document.querySelectorAll('.color-btn'); 
 			 colorBtns.forEach(btn => { 
 				 btn.addEventListener('click', () => { 
 					 colorBtns.forEach(b => b.classList.remove('active')); 
 					 btn.classList.add('active'); 
 					 currentColor = btn.getAttribute('data-color'); 
 					 if (ctx) { 
 						 ctx.strokeStyle = currentColor; 
 					 } 
 				 }); 
 			 }); 
 		 } 

 		 function setupSizeControls() { 
 			 signatureSize = signatureSizes[currentSizeIndex]; 
 			 document.getElementById('size-display').textContent = signatureSizeNames[currentSizeIndex]; 
 		 } 

 		 function changeSignatureSize(direction) { 
 			 const newIndex = currentSizeIndex + direction; 
 			 if (newIndex >= 0 && newIndex < signatureSizes.length) { 
 				 currentSizeIndex = newIndex; 
 				 signatureSize = signatureSizes[currentSizeIndex]; 
 				 document.getElementById('size-display').textContent = signatureSizeNames[currentSizeIndex]; 
 				 
 				 const preview = document.getElementById('signaturePreview'); 
 				 if (preview && preview.style.display !== 'none') { 
 					 preview.style.width = `${signatureSize}%`; 
 					 preview.style.height = `${signatureSize * 0.4}%`; 
 				 } 
 			 } 
 		 } 

 		 async function renderPdfPage() { 
 			 if (!pdfDoc) return; 

 			 try { 
 				 const page = await pdfDoc.getPage(currentPage); 
 				 const pdfCanvas = document.getElementById('pdfCanvas'); 
 				 const context = pdfCanvas.getContext('2d'); 
 				 const container = document.getElementById('pdfContainer'); 
 				 
 				 const viewport = page.getViewport({ scale: 1 }); 
 				 const scale = container.offsetWidth / viewport.width;
 				 const scaledViewport = page.getViewport({ scale: scale }); 

 				 const ratio = window.devicePixelRatio || 1;
 				 pdfCanvas.width = scaledViewport.width * ratio; 
 				 pdfCanvas.height = scaledViewport.height * ratio; 

 				 pdfCanvas.style.width = scaledViewport.width + 'px'; 
 				 pdfCanvas.style.height = scaledViewport.height + 'px'; 

 				 context.scale(ratio, ratio);
 				 
 				 const renderContext = { 
 					 canvasContext: context, 
 					 viewport: scaledViewport 
 				 }; 
 				 await page.render(renderContext).promise; 
 				 
 				 updatePageNavigation(); 
 				 if (currentStep === 3 && !document.getElementById('signaturePreview').innerHTML) {
 					 showSignaturePreview(); 
 				 }
 				 showMultiPageControls(); 
 				 updatePageStatus(); 
 				 setTimeout(() => loadSignatureForCurrentPage(), 100); 
 			 } catch (error) { 
 				 console.error('B≈ÇƒÖd renderowania strony PDF:', error); 
 			 } 
 		 } 

 		 function updatePageNavigation() { 
 			 document.getElementById('prevPageBtn').disabled = currentPage <= 1; 
 			 document.getElementById('nextPageBtn').disabled = currentPage >= totalPages; 
 			 document.getElementById('pageInfo').textContent = `Strona ${currentPage} z ${totalPages}`; 
 		 } 

 		 function previousPage() { 
 			 if (currentPage > 1) { 
 				 currentPage--; 
 				 renderPdfPage(); 
 			 } 
 		 } 

 		 function nextPage() { 
 			 if (currentPage < totalPages) { 
 				 currentPage++; 
 				 renderPdfPage(); 
 			 } 
 		 } 

 		 function loadSignatureForCurrentPage() { 
 			 const preview = document.getElementById('signaturePreview'); 
 			 if (signaturePositions[currentPage]) { 
 				 const savedPosition = signaturePositions[currentPage]; 
 				 preview.style.left = `${savedPosition.x}%`; 
 				 preview.style.top = `${savedPosition.y}%`; 
 				 if (savedPosition.size) { 
 					 signatureSize = savedPosition.size; 
 					 preview.style.width = `${savedPosition.size}%`; 
 					 preview.style.height = `${savedPosition.size * 0.4}%`; 
 					 const sizeIndex = signatureSizes.findIndex(size => size >= savedPosition.size); 
 					 if (sizeIndex >= 0) { 
 						 currentSizeIndex = sizeIndex; 
 						 document.getElementById('size-display').textContent = signatureSizeNames[sizeIndex]; 
 					 } 
 				 } 
 				 signaturePosition = { x: savedPosition.x, y: savedPosition.y, page: currentPage }; 
 			 } else { 
 				 const defaultX = 50 - signatureSize / 2;
 				 const defaultY = 50 - (signatureSize * 0.4) / 2;
 				 preview.style.left = `${defaultX}%`; 
 				 preview.style.top = `${defaultY}%`; 
 				 preview.style.width = `${signatureSize}%`; 
 				 preview.style.height = `${signatureSize * 0.4}%`; 
 				 signaturePosition = { x: defaultX, y: defaultY, page: currentPage }; 
 			 } 
 			 updateSignatureButtons(); 
 			 updateConfirmButton(); 
 		 } 

 		 function showSignaturePreview() { 
 			 const preview = document.getElementById('signaturePreview'); 
 			 if (!signatureDataUrl) return; 
 			 
 			 preview.innerHTML = ` 
 				 <div class="signature-controls"> 
 					 <button class="signature-btn" onclick="saveSignaturePosition(event)" id="saveBtn-${currentPage}">üíæ Zapisz</button> 
 					 <button class="signature-btn" onclick="removeSignatureFromPage(event)" id="removeBtn-${currentPage}" style="display: none; background: #ef4444;">üóëÔ∏è Usu≈Ñ</button> 
 				 </div> 
 				 <img src="${signatureDataUrl}" style="width: 100%; height: 100%; object-fit: contain;" alt="Podpis"> 
 				 <div class="resize-handle">‚§¢</div>`; 
 			 
 			 preview.style.display = 'flex'; 
 			 loadSignatureForCurrentPage();
 			 makeDraggable(preview); 
 			 makeResizable(preview, preview.querySelector('.resize-handle')); 
 		 } 

 		 function saveSignaturePosition(event) { 
 			 event.stopPropagation();
 			 if (!signaturePosition) return; 
 			 
 			 signaturePositions[currentPage] = { x: signaturePosition.x, y: signaturePosition.y, page: currentPage, size: signatureSize }; 
 			 signedPages.add(currentPage); 
 			 acceptedPosition = { x: signaturePosition.x, y: signaturePosition.y, size: signatureSize }; 
 			 
 			 updatePageStatus(); 
 			 updateSignatureButtons(); 
 			 updateConfirmButton(); 
 			 
 			 if (totalPages > 1) { 
 				 document.getElementById('applyAllBtn').style.display = 'inline-block'; 
 			 } 
 		 } 

 		 function updateSignatureButtons() { 
 			 const saveBtn = document.getElementById(`saveBtn-${currentPage}`); 
 			 const removeBtn = document.getElementById(`removeBtn-${currentPage}`); 
 			 if (saveBtn && removeBtn) {
 				 if (signedPages.has(currentPage)) { 
 					 saveBtn.textContent = '‚úÖ Zapisano'; 
 					 saveBtn.classList.add('applied'); 
 					 removeBtn.style.display = 'inline-block'; 
 				 } else {
 					 saveBtn.textContent = 'üíæ Zapisz';
 					 saveBtn.classList.remove('applied');
 					 removeBtn.style.display = 'none';
 				 }
 			 }
 		 } 

 		 function removeSignatureFromPage(event) { 
 			 event.stopPropagation();
 			 if (!signedPages.has(currentPage)) return; 
 			 
 			 delete signaturePositions[currentPage]; 
 			 signedPages.delete(currentPage); 
 			 
 			 updatePageStatus(); 
 			 updateSignatureButtons(); 
 			 updateConfirmButton(); 
 		 } 

 		 function updatePageStatus() { 
 			 const statusContainer = document.getElementById('pageStatus'); 
 			 statusContainer.innerHTML = ''; 
 			 for (let i = 1; i <= totalPages; i++) { 
 				 const indicator = document.createElement('div'); 
 				 indicator.className = 'page-indicator'; 
 				 indicator.textContent = i; 
 				 if (i === currentPage) indicator.classList.add('current'); 
 				 if (signedPages.has(i)) indicator.classList.add('signed'); 
 				 statusContainer.appendChild(indicator); 
 			 } 
 		 } 

 		 function applyToAllPages() { 
 			 if (!acceptedPosition) {
 				 alert('Najpierw zapisz pozycjƒô podpisu na jednej ze stron!');
 				 return;
 			 }
 			 for (let i = 1; i <= totalPages; i++) { 
 				 signaturePositions[i] = { x: acceptedPosition.x, y: acceptedPosition.y, page: i, size: acceptedPosition.size }; 
 				 signedPages.add(i); 
 			 } 
 			 updatePageStatus(); 
 			 updateSignatureButtons(); 
 			 updateConfirmButton(); 
 			 alert(`‚úÖ Podpis zosta≈Ç dodany do wszystkich ${totalPages} stron!`); 
 		 } 

 		 function makeDraggable(element) { 
 			 let isDragging = false, startX, startY, startLeft, startTop; 
 			 const container = document.getElementById('pdfContainer');

 			 const handleStart = (e) => { 
 				 if (e.target.classList.contains('resize-handle') || e.target.classList.contains('signature-btn')) return; 
 				 e.preventDefault();
 				 isDragging = true; 
 				 const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX; 
 				 const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY; 
 				 startX = clientX; 
 				 startY = clientY; 
 				 startLeft = element.offsetLeft;
 				 startTop = element.offsetTop;
 			 }; 
 			 
 			 const handleMove = (e) => { 
 				 if (!isDragging) return; 
 				 e.preventDefault();
 				 const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX; 
 				 const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY; 
 				 const deltaX = clientX - startX; 
 				 const deltaY = clientY - startY; 
 				 const newLeft = Math.max(0, Math.min(container.clientWidth - element.offsetWidth, startLeft + deltaX));
 				 const newTop = Math.max(0, Math.min(container.clientHeight - element.offsetHeight, startTop + deltaY));
 				 
 				 element.style.left = `${newLeft / container.clientWidth * 100}%`; 
 				 element.style.top = `${newTop / container.clientHeight * 100}%`; 
 			 }; 
 			 
 			 const handleEnd = () => { 
 				 if (isDragging) { 
 					 isDragging = false; 
 					 signaturePosition.x = parseFloat(element.style.left); 
 					 signaturePosition.y = parseFloat(element.style.top); 
 					 signaturePosition.page = currentPage; 
 				 } 
 			 }; 
 			 
 			 element.addEventListener('mousedown', handleStart); 
 			 element.addEventListener('touchstart', handleStart, { passive: false }); 
 			 document.addEventListener('mousemove', handleMove); 
 			 document.addEventListener('touchmove', handleMove, { passive: false }); 
 			 document.addEventListener('mouseup', handleEnd); 
 			 document.addEventListener('touchend', handleEnd); 
 		 } 

 		 function makeResizable(element, handle) { 
 			 let isResizing = false, startSize, startClientX; 
 			 const container = document.getElementById('pdfContainer');

 			 const handleStart = (e) => { 
 				 e.preventDefault();
 				 e.stopPropagation();
 				 isResizing = true; 
 				 startSize = signatureSize; 
 				 startClientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX; 
 			 }; 
 			 
 			 const handleMove = (e) => { 
 				 if (!isResizing) return; 
 				 e.preventDefault();
 				 const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX; 
 				 const deltaX = clientX - startClientX; 
 				 const sizeDelta = (deltaX / container.clientWidth) * 50; 
 				 const newSize = Math.max(5, Math.min(50, startSize + sizeDelta)); 
 				 signatureSize = newSize; 
 				 
 				 element.style.width = `${newSize}%`; 
 				 element.style.height = `${newSize * 0.4}%`; 
 				 
 				 const sizeIndex = signatureSizes.findIndex(size => size >= newSize); 
 				 if (sizeIndex >= 0) { 
 					 currentSizeIndex = sizeIndex; 
 					 document.getElementById('size-display').textContent = signatureSizeNames[sizeIndex]; 
 				 } 
 			 }; 
 			 
 			 const handleEnd = () => { 
 				 if (isResizing) { 
 					 isResizing = false; 
 					 if (signaturePosition) signaturePosition.size = signatureSize; 
 				 } 
 			 }; 
 			 
 			 handle.addEventListener('mousedown', handleStart); 
 			 handle.addEventListener('touchstart', handleStart, { passive: false }); 
 			 document.addEventListener('mousemove', handleMove); 
 			 document.addEventListener('touchmove', handleMove, { passive: false }); 
 			 document.addEventListener('mouseup', handleEnd); 
 			 document.addEventListener('touchend', handleEnd); 
 		 } 

 		 function nextStep() { 
 			 if (currentStep < 4) { 
 				 document.getElementById(`content-${currentStep}`).classList.remove('active'); 
 				 document.getElementById(`step-${currentStep}`).classList.remove('active'); 
 				 document.getElementById(`step-${currentStep}`).classList.add('completed'); 
 				 currentStep++; 
 				 document.getElementById(`content-${currentStep}`).classList.add('active'); 
 				 document.getElementById(`step-${currentStep}`).classList.add('active'); 

 				 if (currentStep === 2) setupSignatureCanvas(); 
 				 else if (currentStep === 3) {
 					 signatureDataUrl = canvas.toDataURL(); 
 					 renderPdfPage(); 
 				 } else if (currentStep === 4) { 
 					 if (signedPages.size === 0) { 
 						 alert('‚ùå Najpierw zapisz podpis na przynajmniej jednej stronie!'); 
 						 previousStep(); // Wr√≥ƒá do kroku 3
 						 document.getElementById(`step-4`).classList.remove('active', 'completed');
 						 return; 
 					 } 
 					 generateSignedPdf(); 
 				 } 
 			 } 
 		 } 

 		 function previousStep() { 
 			 if (currentStep > 1) { 
 				 document.getElementById(`content-${currentStep}`).classList.remove('active'); 
 				 document.getElementById(`step-${currentStep}`).classList.remove('active'); 
 				 currentStep--; 
 				 document.getElementById(`content-${currentStep}`).classList.add('active'); 
 				 document.getElementById(`step-${currentStep}`).classList.add('active'); 
 				 document.getElementById(`step-${currentStep}`).classList.remove('completed'); 
 			 } 
 		 } 

 		 async function generateSignedPdf() { 
 			 document.getElementById('processingIndicator').style.display = 'block'; 
 			 document.getElementById('downloadSection').style.display = 'none';
 			 try { 
 				 const arrayBuffer = await pdfFile.arrayBuffer(); 
 				 const pdfDocToModify = await PDFLib.PDFDocument.load(arrayBuffer, { ignoreEncryption: true });
 				 const pages = pdfDocToModify.getPages(); 
 				 const signatureImage = await pdfDocToModify.embedPng(signatureDataUrl); 
 				 
 				 for (const pageNum of signedPages) { 
 					 const position = signaturePositions[pageNum]; 
 					 if (!position) continue; 
 					 const targetPage = pages[pageNum - 1]; 
 					 const { width, height } = targetPage.getSize(); 
 					 const signatureWidth = position.size / 100 * width; 
 					 const signatureHeight = signatureWidth * (signatureImage.height / signatureImage.width);
 					 const x = (position.x / 100) * width; 
 					 const y = height - (position.y / 100) * height - signatureHeight; 

 					 targetPage.drawImage(signatureImage, { x, y, width: signatureWidth, height: signatureHeight }); 
 				 } 
 				 
 				 const pdfBytes = await pdfDocToModify.save(); 
 				 
 				 window.signedPdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
 				 window.signedPdfName = pdfFile.name.replace(/\.pdf$/i, '_podpisany.pdf');
 				 
 				 document.getElementById('processingIndicator').style.display = 'none'; 
 				 document.getElementById('downloadSection').style.display = 'block'; 
 				 document.getElementById('downloadFileName').textContent = window.signedPdfName;

 			 } catch (error) { 
 				 console.error('B≈ÇƒÖd generowania PDF:', error); 
 				 alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas generowania pliku PDF.');
 				 document.getElementById('processingIndicator').style.display = 'none'; 
 			 } 
 		 } 
 		 
 		 function downloadPdf() { 
 			 if (!window.signedPdfBlob || !window.signedPdfName) return;
 			 const url = URL.createObjectURL(window.signedPdfBlob); 
 			 const link = document.createElement('a'); 
 			 link.href = url; 
 			 link.download = window.signedPdfName; 
 			 document.body.appendChild(link); 
 			 link.click(); 
 			 document.body.removeChild(link); 
 			 URL.revokeObjectURL(url);
 		 } 
 		 
 		 async function sendEmail() {
 			 if (!window.signedPdfBlob || !window.signedPdfName) {
 				 alert("Najpierw wygeneruj podpisany plik.");
 				 return;
 			 }
 			 if (navigator.share) {
 				 try {
 					 const file = new File([window.signedPdfBlob], window.signedPdfName, { type: 'application/pdf' });
 					 await navigator.share({
 						 title: 'Podpisany Dokument',
 						 text: `W za≈ÇƒÖczniku podpisany plik: ${window.signedPdfName}`,
 						 files: [file]
 					 });
 				 } catch (error) {
 					 console.error('B≈ÇƒÖd udostƒôpniania:', error);
 				 }
 			 } else {
 				 const subject = encodeURIComponent('Podpisany dokument PDF'); 
 				 const body = encodeURIComponent(`W za≈ÇƒÖczniku podpisany dokument: ${window.signedPdfName}`); 
 				 window.location.href = `mailto:?subject=${subject}&body=${body}`; 
 			 }
 		 } 
 		 
 		 function signAnother() { 
 			 window.location.reload(); 
 		 } 

 		 function updateConfirmButton() { 
 			 const confirmBtn = document.getElementById('placementNext'); 
 			 if (confirmBtn) { 
 				 confirmBtn.disabled = signedPages.size === 0; 
 			 } 
 		 } 

 		 document.getElementById('passwordInput').addEventListener('keypress', function(e) { 
 			 if (e.key === 'Enter') unlockPdf(); 
 		 }); 

 		 window.addEventListener('resize', () => {
 			 if (currentStep === 3) {
 				 renderPdfPage();
 			 }
 			 if (currentStep === 2) {
 				 setupSignatureCanvas();
 			 }
 		 });

 	 </script> 
 </body> 
 </html>
